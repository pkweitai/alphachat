worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # Define a shared memory zone for connection limiting
    limit_conn_zone $binary_remote_addr zone=addr:10m;
    limit_req_zone $binary_remote_addr zone=one:10m rate=10r/s;

    keepalive_timeout  6500;

    # Redirect HTTP to HTTPS for alphaaie.org
    server {
        listen 80;
        server_name alphaaie.org www.alphaaie.org;

        # Redirect all HTTP traffic to HTTPS
        return 301 https://alphaaie.org$request_uri;
    }

    # HTTPS configuration for alphaaie.org
    server {
        listen 443 ssl;
        server_name alphaaie.org www.alphaaie.org;

        ssl_certificate  /etc/letsencrypt/live/alphaaie.org-0001/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/alphaaie.org-0001/privkey.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";

        # Security Headers
        add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://www.gstatic.com https://assets.calendly.com;
        script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        img-src 'self' https://i.ytimg.com https://yt3.ggpht.com https://www.google.com https://www.google-analytics.com https://stats.g.doubleclick.net https://www.gstatic.com https://raw.githubusercontent.com https://www.googletagmanager.com data:;
        connect-src 'self' https://www.googleapis.com https://jnn-pa.googleapis.com https://csp.withgoogle.com https://cct.google https://play.google.com https://alphaaie.org https://cdn.socket.io https://youtube.com https://www.youtube.com https://youtu.be https://viacon.corp.google.com https://yurt.corp.google.com https://www.google-analytics.com https://stripe.com https://api.sprig.com https://cdn.sprig.com https://cdn.segment.com https://pendo-io-static.storage.googleapis.com https://pendo-static-5885846602252288.storage.googleapis.com https://data.pendo.io https://privacyportal.onetrust.com https://cdn.cookielaw.org https://app.pendo.io;
        font-src 'self' https://fonts.gstatic.com;
        frame-src 'self' https://www.youtube.com https://youtu.be https://www.facebook.com https://youtube.com https://music.youtube.com https://stripe.com https://calendar.google.com https://checkout.stripe.com https://geolocation.onetrust.com https://assets.calendly.com https://calendly.com;
        object-src 'none';
        media-src 'self' https://www.youtube.com https://youtu.be https://music.youtube.com;
        frame-ancestors 'self' https://www.youtube.com https://youtube.com;
        upgrade-insecure-requests;
        ";

        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
        add_header X-Content-Type-Options "nosniff" always;


# Custom error page configuration
    error_page 502 /custom_502.html;
    location = /502.html {
        root /usr/local/html/error;
        internal;
    }



        # Redirect root to /alpha
        location = / {
            return 301 https://alphaaie.org/alpha;
        }

        # Proxy other requests to the application backend
        location / {
            # Apply the connection limit
            limit_conn addr 10;
            # Apply the rate limiting
            limit_req zone=one burst=20 nodelay;
            proxy_pass http://127.0.0.1:5643;  # Replace with your app's backend address if different
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }


        # Let's Encrypt ACME challenge location
        location /.well-known/acme-challenge/ {
            root /usr/local/var/www;
        }


    }

    # Redirect HTTP to HTTPS for storyflix.live and api.storyflix.live
    server {
        listen 80;
        server_name storyflix.live www.storyflix.live api.storyflix.live;

        # Redirect all HTTP traffic to HTTPS
        return 301 https://$host$request_uri;
    }

    # HTTPS configuration for storyflix.live and api.storyflix.live
    server {
        listen 443 ssl;
        server_name storyflix.live www.storyflix.live;

        ssl_certificate /etc/letsencrypt/live/storyflix.live/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/storyflix.live/privkey.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";

        # Security Headers
        add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://www.gstatic.com https://assets.calendly.com;
        script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        img-src 'self' https://i.ytimg.com https://yt3.ggpht.com https://www.google.com https://www.google-analytics.com https://stats.g.doubleclick.net https://www.gstatic.com https://raw.githubusercontent.com https://www.googletagmanager.com data:;
        connect-src 'self' https://www.googleapis.com https://jnn-pa.googleapis.com https://csp.withgoogle.com https://cct.google https://play.google.com https://alphaaie.org https://cdn.socket.io https://youtube.com https://www.youtube.com https://youtu.be https://viacon.corp.google.com https://yurt.corp.google.com https://www.google-analytics.com https://stripe.com https://api.sprig.com https://cdn.sprig.com https://cdn.segment.com https://pendo-io-static.storage.googleapis.com https://pendo-static-5885846602252288.storage.googleapis.com https://data.pendo.io https://privacyportal.onetrust.com https://cdn.cookielaw.org https://app.pendo.io;
        font-src 'self' https://fonts.gstatic.com;
        frame-src 'self' https://www.youtube.com https://youtu.be https://www.facebook.com https://youtube.com https://music.youtube.com https://stripe.com https://calendar.google.com https://checkout.stripe.com https://geolocation.onetrust.com https://assets.calendly.com https://calendly.com;
        object-src 'none';
        media-src 'self' https://www.youtube.com https://youtu.be https://music.youtube.com;
        frame-ancestors 'self' https://www.youtube.com https://youtube.com;
        upgrade-insecure-requests;
        ";

        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
        add_header X-Content-Type-Options "nosniff" always;

        # Proxy requests to the application backend
        location / {
            # Apply the connection limit
            limit_conn addr 10;
            # Apply the rate limiting
            limit_req zone=one burst=20 nodelay;

            proxy_pass http://127.0.0.1:5643;  # Replace with your app's backend address if different
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Let's Encrypt ACME challenge location
        location /.well-known/acme-challenge/ {
            root /usr/local/var/www;
        }
    }

    # HTTPS configuration for api.storyflix.live
    server {
        listen 443 ssl;
        server_name api.storyflix.live;

        ssl_certificate /etc/letsencrypt/live/storyflix.live/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/storyflix.live/privkey.pem;

        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;
        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";

        # Security Headers
        add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com https://www.gstatic.com https://assets.calendly.com;
        script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        img-src 'self' https://i.ytimg.com https://unpkg.com https://yt3.ggpht.com https://www.google.com https://www.google-analytics.com https://stats.g.doubleclick.net https://www.gstatic.com https://raw.githubusercontent.com https://www.googletagmanager.com data:;
        connect-src 'self' https://unpkg.com https://www.googleapis.com https://jnn-pa.googleapis.com https://csp.withgoogle.com https://cct.google https://play.google.com https://alphaaie.org https://cdn.socket.io https://youtube.com https://www.youtube.com https://youtu.be https://viacon.corp.google.com https://yurt.corp.google.com https://www.google-analytics.com https://stripe.com https://api.sprig.com https://cdn.sprig.com https://cdn.segment.com https://pendo-io-static.storage.googleapis.com https://pendo-static-5885846602252288.storage.googleapis.com https://data.pendo.io https://privacyportal.onetrust.com https://cdn.cookielaw.org https://app.pendo.io;
        font-src 'self' https://unpkg.com https://fonts.gstatic.com;
        frame-src 'self' https://www.youtube.com https://youtu.be https://www.facebook.com https://youtube.com https://music.youtube.com https://stripe.com https://calendar.google.com https://checkout.stripe.com https://geolocation.onetrust.com https://assets.calendly.com https://calendly.com;
        object-src 'none';
        media-src 'self' https://unpkg.com https://www.youtube.com https://youtu.be https://music.youtube.com;
        frame-ancestors 'self' https://www.youtube.com https://youtube.com;
        upgrade-insecure-requests;
        ";

        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
        add_header X-Content-Type-Options "nosniff" always;

        location / {
                        # Apply the rate limiting
            limit_req zone=one burst=20 nodelay;
            # Apply the connection limit
            limit_conn addr 10;


	    proxy_pass http://192.168.1.38:5000;  # API backend server
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

 	 # Add timeout settings
            proxy_read_timeout 6000s;  # Increase as needed
            proxy_send_timeout 6000s;  # Increase as needed
            proxy_connect_timeout 6000s;  # Increase as needed

        }
    }



    server {
        listen 443 ssl;
        server_name news.storyflix.live;
    ssl_certificate /etc/letsencrypt/live/news.storyflix.live/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/news.storyflix.live/privkey.pem; # managed by Certbot

        ssl_protocols TLSv1.2 TLSv1.3; 
        ssl_prefer_server_ciphers on;
        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";

        # Security Headers
        add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com https://www.gstatic.com https://assets.calendly.com;
        script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
        img-src 'self' https://i.ytimg.com https://unpkg.com https://yt3.ggpht.com https://www.google.com https://www.google-analytics.com https://stats.g.doubleclick.net https://www.gstatic.com https://raw.githubusercontent.com https://www.googletagmanager.com data:;
        connect-src 'self' https://unpkg.com https://www.googleapis.com https://jnn-pa.googleapis.com https://csp.withgoogle.com https://cct.google https://play.google.com https://alphaaie.org https://cdn.socket.io https://youtube.com https://www.youtube.com https://youtu.be https://viacon.corp.google.com https://yurt.corp.google.com https://www.google-analytics.com https://stripe.com https://api.sprig.com https://cdn.sprig.com https://cdn.segment.com https://pendo-io-static.storage.googleapis.com https://pendo-static-5885846602252288.storage.googleapis.com https://data.pendo.io https://privacyportal.onetrust.com https://cdn.cookielaw.org https://app.pendo.io;
        font-src 'self' https://unpkg.com https://fonts.gstatic.com;
        frame-src 'self' https://www.youtube.com https://youtu.be https://www.facebook.com https://youtube.com https://music.youtube.com https://stripe.com https://calendar.google.com https://checkout.stripe.com https://geolocation.onetrust.com https://assets.calendly.com https://calendly.com; 
        object-src 'none';
        media-src 'self' https://unpkg.com https://www.youtube.com https://youtu.be https://music.youtube.com;
        frame-ancestors 'self' https://www.youtube.com https://youtube.com;
        upgrade-insecure-requests;
        ";
        
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
        add_header X-Content-Type-Options "nosniff" always;

        location / {
             # Apply the connection limit
            limit_conn addr 10;
           # Apply the rate limiting
            limit_req zone=one burst=20 nodelay;
            proxy_pass http://127.0.0.1:9898;  # API backend server
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        
         # Add timeout settings
            proxy_read_timeout 6000s;  # Increase as needed
            proxy_send_timeout 6000s;  # Increase as needed
            proxy_connect_timeout 6000s;  # Increase as needed

        } 
    
}   

# HTTPS configuration for viq.alphaaie.org
server {
    listen 443 ssl;
    server_name viq.alphaaie.org;

    ssl_certificate  /etc/letsencrypt/live/alphaaie.org-0001/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/alphaaie.org-0001/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";

    # Security Headers
    add_header Content-Security-Policy "
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://www.gstatic.com https://assets.calendly.com;
    script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://cdn.socket.io https://www.google-analytics.com https://www.googletagmanager.com https://www.gstatic.com https://www.facebook.com https://csp.withgoogle.com https://pagead2.googlesyndication.com https://googleads.g.doubleclick.net https://static.doubleclick.net https://stats.g.doubleclick.net https://td.doubleclick.net https://s.youtube.com https://yurt.corp.google.com https://youtube.com https://www.youtube.com https://youtubei.googleapis.com https://connect.facebook.net https://tagassistant.google.com https://www.instagram.com https://wa.me https://maps.googleapis.com https://js.stripe.com https://m.stripe.network https://m.stripe.com https://www.linkedin.com https://cdn.cookielaw.org https://www.recaptcha.net https://rr1---sn-n4v7snee.c.youtube.com https://rr2---sn-o097znsd.c.youtube.com https://rr2---sn-n4v7snle.c.youtube.com https://api.sprig.com https://segment.com https://cdn.segment.com https://cdn.sprig.com https://cdn.pendo.io https://www.pendo.io https://assets.calendly.com;
    img-src 'self' https://i.ytimg.com https://yt3.ggpht.com https://www.google.com https://www.google-analytics.com https://stats.g.doubleclick.net https://www.gstatic.com https://raw.githubusercontent.com https://www.googletagmanager.com data:;
    connect-src 'self' https://www.googleapis.com https://jnn-pa.googleapis.com https://csp.withgoogle.com https://cct.google https://play.google.com https://alphaaie.org https://cdn.socket.io https://youtube.com https://www.youtube.com https://youtu.be https://viacon.corp.google.com https://yurt.corp.google.com https://www.google-analytics.com https://stripe.com https://api.sprig.com https://cdn.sprig.com https://cdn.segment.com https://pendo-io-static.storage.googleapis.com https://pendo-static-5885846602252288.storage.googleapis.com https://data.pendo.io https://privacyportal.onetrust.com https://cdn.cookielaw.org https://app.pendo.io;
    font-src 'self' https://fonts.gstatic.com;
    frame-src 'self' https://www.youtube.com https://youtu.be https://www.facebook.com https://youtube.com https://music.youtube.com https://stripe.com https://calendar.google.com https://checkout.stripe.com https://geolocation.onetrust.com https://assets.calendly.com https://calendly.com;
    object-src 'none';
    media-src 'self' https://www.youtube.com https://youtu.be https://music.youtube.com;
    frame-ancestors 'self' https://www.youtube.com https://youtube.com;
    upgrade-insecure-requests;
    ";

    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    add_header X-Content-Type-Options "nosniff" always;
    
    # Custom error page configuration
    error_page 502 /custom_502.html;
    location = /502.html {
        root /usr/local/html/error;
        internal;
    }
    # Proxy requests to the viq application backend
    location / {
        proxy_pass http://192.168.1.38:7508/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Let's Encrypt ACME challenge location
    location /.well-known/acme-challenge/ {
        root /usr/local/var/www;
    }
}


    include servers/*;
}